"use strict";
/**
 * @packageDocumentation
 * @module Common-AssetAmount
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.StandardAssetAmountDestination = exports.AssetAmount = void 0;
const buffer_1 = require("buffer/");
const bn_js_1 = __importDefault(require("bn.js"));
/**
 * Class for managing asset amounts in the UTXOSet fee calcuation
 */
class AssetAmount {
    constructor(assetID, amount, burn) {
        this.assetID = buffer_1.Buffer.alloc(32);
        this.amount = new bn_js_1.default(0);
        this.burn = new bn_js_1.default(0);
        this.spent = new bn_js_1.default(0);
        this.change = new bn_js_1.default(0);
        this.stakeableLockSpent = new bn_js_1.default(0);
        this.stakeableLockChange = false;
        this.finished = false;
        this.getAssetID = () => {
            return this.assetID;
        };
        this.getAssetIDString = () => {
            return this.assetID.toString("hex");
        };
        this.getAmount = () => {
            return this.amount;
        };
        this.getSpent = () => {
            return this.spent;
        };
        this.getBurn = () => {
            return this.burn;
        };
        this.getChange = () => {
            return this.change;
        };
        this.getStakeableLockSpent = () => {
            return this.stakeableLockSpent;
        };
        this.getStakeableLockChange = () => {
            return this.stakeableLockChange;
        };
        this.isFinished = () => {
            return this.finished;
        };
        this.spendAmount = (amt, stakeableLocked = false) => {
            if (!this.finished) {
                let total = this.amount.add(this.burn);
                this.spent = this.spent.add(amt);
                if (stakeableLocked) {
                    this.stakeableLockSpent = this.stakeableLockSpent.add(amt);
                }
                if (this.spent.gte(total)) {
                    this.change = this.spent.sub(total);
                    if (stakeableLocked) {
                        this.stakeableLockChange = true;
                    }
                    this.finished = true;
                }
            }
            return this.finished;
        };
        this.assetID = assetID;
        this.amount = typeof amount === "undefined" ? new bn_js_1.default(0) : amount;
        this.burn = typeof burn === "undefined" ? new bn_js_1.default(0) : burn;
        this.spent = new bn_js_1.default(0);
        this.stakeableLockSpent = new bn_js_1.default(0);
        this.stakeableLockChange = false;
    }
}
exports.AssetAmount = AssetAmount;
class StandardAssetAmountDestination {
    constructor(destinations, senders, changeAddresses) {
        this.amounts = [];
        this.destinations = [];
        this.senders = [];
        this.changeAddresses = [];
        this.amountkey = {};
        this.inputs = [];
        this.outputs = [];
        this.change = [];
        this.addAssetAmount = (assetID, amount, burn) => {
            let aa = new AssetAmount(assetID, amount, burn);
            this.amounts.push(aa);
            this.amountkey[aa.getAssetIDString()] = aa;
        };
        this.addInput = (input) => {
            this.inputs.push(input);
        };
        this.addOutput = (output) => {
            this.outputs.push(output);
        };
        this.addChange = (output) => {
            this.change.push(output);
        };
        this.getAmounts = () => {
            return this.amounts;
        };
        this.getDestinations = () => {
            return this.destinations;
        };
        this.getSenders = () => {
            return this.senders;
        };
        this.getChangeAddresses = () => {
            return this.changeAddresses;
        };
        this.getAssetAmount = (assetHexStr) => {
            return this.amountkey[assetHexStr];
        };
        this.assetExists = (assetHexStr) => {
            return (assetHexStr in this.amountkey);
        };
        this.getInputs = () => {
            return this.inputs;
        };
        this.getOutputs = () => {
            return this.outputs;
        };
        this.getChangeOutputs = () => {
            return this.change;
        };
        this.getAllOutputs = () => {
            return this.outputs.concat(this.change);
        };
        this.canComplete = () => {
            for (let i = 0; i < this.amounts.length; i++) {
                if (!this.amounts[i].isFinished()) {
                    return false;
                }
            }
            return true;
        };
        this.destinations = destinations;
        this.changeAddresses = changeAddresses;
        this.senders = senders;
    }
}
exports.StandardAssetAmountDestination = StandardAssetAmountDestination;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXRhbW91bnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tbW9uL2Fzc2V0YW1vdW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7Ozs7OztBQUVILG9DQUFpQztBQUNqQyxrREFBdUI7QUFJdkI7O0dBRUc7QUFDSCxNQUFhLFdBQVc7SUFnRXBCLFlBQVksT0FBYyxFQUFFLE1BQVMsRUFBRSxJQUFPO1FBL0RwQyxZQUFPLEdBQVUsZUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsQyxXQUFNLEdBQU0sSUFBSSxlQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdEIsU0FBSSxHQUFNLElBQUksZUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BCLFVBQUssR0FBTSxJQUFJLGVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyQixXQUFNLEdBQU0sSUFBSSxlQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdEIsdUJBQWtCLEdBQU8sSUFBSSxlQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkMsd0JBQW1CLEdBQVcsS0FBSyxDQUFDO1FBQ3BDLGFBQVEsR0FBVyxLQUFLLENBQUM7UUFFbkMsZUFBVSxHQUFHLEdBQVUsRUFBRTtZQUN2QixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDdEIsQ0FBQyxDQUFBO1FBRUQscUJBQWdCLEdBQUcsR0FBVSxFQUFFO1lBQzdCLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdEMsQ0FBQyxDQUFBO1FBRUQsY0FBUyxHQUFHLEdBQU0sRUFBRTtZQUNsQixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUE7UUFDcEIsQ0FBQyxDQUFBO1FBRUQsYUFBUSxHQUFHLEdBQU0sRUFBRTtZQUNqQixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDcEIsQ0FBQyxDQUFBO1FBRUQsWUFBTyxHQUFH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QzNDLE9BQU8sQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3pDLENBQUMsQ0FBQTtRQUVELGNBQVMsR0FBRyxHQUFhLEVBQUU7WUFDekIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQ3JCLENBQUMsQ0FBQTtRQUVELGVBQVUsR0FBRyxHQUFhLEVBQUU7WUFDMUIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDO1FBQ3RCLENBQUMsQ0FBQTtRQUVELHFCQUFnQixHQUFHLEdBQWEsRUFBRTtZQUNoQyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDckIsQ0FBQyxDQUFBO1FBRUQsa0JBQWEsR0FBRyxHQUFhLEVBQUU7WUFDN0IsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDMUMsQ0FBQyxDQUFBO1FBRUQsZ0JBQVcsR0FBRyxHQUFXLEVBQUU7WUFDekIsS0FBSSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUMzQyxJQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRTtvQkFFaEMsT0FBTyxLQUFLLENBQUM7aUJBQ2Q7YUFDRjtZQUNELE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxDQUFBO1FBR0MsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7UUFDakMsSUFBSSxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUM7UUFDdkMsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7SUFDekIsQ0FBQztDQUVGO0FBcEZELHdFQW9GQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQHBhY2thZ2VEb2N1bWVudGF0aW9uXG4gKiBAbW9kdWxlIENvbW1vbi1Bc3NldEFtb3VudFxuICovXG5cbmltcG9ydCB7IEJ1ZmZlciB9IGZyb20gJ2J1ZmZlci8nO1xuaW1wb3J0IEJOIGZyb20gJ2JuLmpzJztcbmltcG9ydCB7IFN0YW5kYXJkVHJhbnNmZXJhYmxlT3V0cHV0IH0gZnJvbSAnLi9vdXRwdXQnO1xuaW1wb3J0IHsgU3RhbmRhcmRUcmFuc2ZlcmFibGVJbnB1dCB9IGZyb20gJy4vaW5wdXQnO1xuXG4vKipcbiAqIENsYXNzIGZvciBtYW5hZ2luZyBhc3NldCBhbW91bnRzIGluIHRoZSBVVFhPU2V0IGZlZSBjYWxjdWF0aW9uXG4gKi9cbmV4cG9ydCBjbGFzcyBBc3NldEFtb3VudCB7XG4gICAgcHJvdGVjdGVkIGFzc2V0SUQ6QnVmZmVyID0gQnVmZmVyLmFsbG9jKDMyKTtcbiAgICBwcm90ZWN0ZWQgYW1vdW50OkJOID0gbmV3IEJOKDApO1xuICAgIHByb3RlY3RlZCBidXJuOkJOID0gbmV3IEJOKDApO1xuICAgIHByb3RlY3RlZCBzcGVudDpCTiA9IG5ldyBCTigwKTtcbiAgICBwcm90ZWN0ZWQgY2hhbmdlOkJOID0gbmV3IEJOKDApO1xuICAgIHByb3RlY3RlZCBzdGFrZWFibGVMb2NrU3BlbnQ6Qk4gID0gbmV3IEJOKDApO1xuICAgIHByb3RlY3RlZCBzdGFrZWFibGVMb2NrQ2hhbmdlOmJvb2xlYW4gPSBmYWxzZTtcbiAgICBwcm90ZWN0ZWQgZmluaXNoZWQ6Ym9vbGVhbiA9IGZhbHNlO1xuICBcbiAgICBnZXRBc3NldElEID0gKCk6QnVmZmVyID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmFzc2V0SUQ7XG4gICAgfVxuICBcbiAgICBnZXRBc3NldElEU3RyaW5nID0gKCk6c3RyaW5nID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmFzc2V0SUQudG9TdHJpbmcoXCJoZXhcIik7XG4gICAgfVxuICBcbiAgICBnZXRBbW91bnQgPSAoKTpCTiA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5hbW91bnRcbiAgICB9XG4gIFxuICAgIGdldFNwZW50ID0gKCk6Qk4gPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuc3BlbnQ7XG4gICAgfVxuICBcbiAgICBnZXRCdXJuID0gKCk6Qk4gPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuYnVybjtcbiAgICB9XG4gIFxuICAgIGdldENoYW5nZSA9ICgpOkJOID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmNoYW5nZTtcbiAgICB9XG5cbiAgICBnZXRTdGFrZWFibGVMb2NrU3BlbnQgPSAoKTpCTiA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5zdGFrZWFibGVMb2NrU3BlbnQ7XG4gICAgfVxuXG4gICAgZ2V0U3Rha2VhYmxlTG9ja0NoYW5nZSA9ICgpOmJvb2xlYW4gPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuc3Rha2VhYmxlTG9ja0NoYW5nZTtcbiAgICB9XG4gIFxuICAgIGlzRmluaXNoZWQgPSAoKTpib29sZWFuID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmZpbmlzaGVkO1xuICAgIH1cbiAgXG4gICAgc3BlbmRBbW91bnQgPSAoYW10OkJOLCBzdGFrZWFibGVMb2NrZWQ6Ym9vbGVhbiA9IGZhbHNlKTpib29sZWFuID0+IHtcbiAgICAgIGlmKCF0aGlzLmZpbmlzaGVkKSB7XG4gICAgICAgIGxldCB0b3RhbDpCTiA9IHRoaXMuYW1vdW50LmFkZCh0aGlzLmJ1cm4pO1xuICAgICAgICB0aGlzLnNwZW50ID0gdGhpcy5zcGVudC5hZGQoYW10KTtcbiAgICAgICAgaWYoc3Rha2VhYmxlTG9ja2VkKXtcbiAgICAgICAgICB0aGlzLnN0YWtlYWJsZUxvY2tTcGVudCA9IHRoaXMuc3Rha2VhYmxlTG9ja1NwZW50LmFkZChhbXQpO1xuICAgICAgICB9XG4gICAgICAgIGlmKHRoaXMuc3BlbnQuZ3RlKHRvdGFsKSkge1xuICAgICAgICAgIHRoaXMuY2hhbmdlID0gdGhpcy5zcGVudC5zdWIodG90YWwpO1xuICAgICAgICAgIGlmKHN0YWtlYWJsZUxvY2tlZCl7XG4gICAgICAgICAgICB0aGlzLnN0YWtlYWJsZUxvY2tDaGFuZ2UgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmZpbmlzaGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuZmluaXNoZWQ7XG4gICAgfVxuICBcbiAgICBjb25zdHJ1Y3Rvcihhc3NldElEOkJ1ZmZlciwgYW1vdW50OkJOLCBidXJuOkJOKSB7XG4gICAgICB0aGlzLmFzc2V0SUQgPSBhc3NldElEO1xuICAgICAgdGhpcy5hbW91bnQgPSB0eXBlb2YgYW1vdW50ID09PSBcInVuZGVmaW5lZFwiID8gbmV3IEJOKDApIDogYW1vdW50O1xuICAgICAgdGhpcy5idXJuID0gdHlwZW9mIGJ1cm4gPT09IFwidW5kZWZpbmVkXCIgPyBuZXcgQk4oMCkgOiBidXJuO1xuICAgICAgdGhpcy5zcGVudCA9IG5ldyBCTigwKTtcbiAgICAgIHRoaXMuc3Rha2VhYmxlTG9ja1NwZW50ID0gbmV3IEJOKDApO1xuICAgICAgdGhpcy5zdGFrZWFibGVMb2NrQ2hhbmdlID0gZmFsc2U7XG4gICAgfVxuICB9XG4gIFxuICBleHBvcnQgYWJzdHJhY3QgY2xhc3MgU3RhbmRhcmRBc3NldEFtb3VudERlc3RpbmF0aW9uPFRPIGV4dGVuZHMgU3RhbmRhcmRUcmFuc2ZlcmFibGVPdXRwdXQsIFRJIGV4dGVuZHMgU3RhbmRhcmRUcmFuc2ZlcmFibGVJbnB1dD4gIHtcbiAgICBwcm90ZWN0ZWQgYW1vdW50czpBcnJheTxBc3NldEFtb3VudD4gPSBbXTtcbiAgICBwcm90ZWN0ZWQgZGVzdGluYXRpb25zOkFycmF5PEJ1ZmZlcj4gPSBbXTtcbiAgICBwcm90ZWN0ZWQgc2VuZGVyczpBcnJheTxCdWZmZXI+ID0gW107XG4gICAgcHJvdGVjdGVkIGNoYW5nZUFkZHJlc3NlczpBcnJheTxCdWZmZXI+ID0gW107XG4gICAgcHJvdGVjdGVkIGFtb3VudGtleTpvYmplY3QgPSB7fTtcbiAgICBwcm90ZWN0ZWQgaW5wdXRzOkFycmF5PFRJPiA9IFtdO1xuICAgIHByb3RlY3RlZCBvdXRwdXRzOkFycmF5PFRPPiA9IFtdO1xuICAgIHByb3RlY3RlZCBjaGFuZ2U6QXJyYXk8VE8+ID0gW107XG4gIFxuICAgIGFkZEFzc2V0QW1vdW50ID0gKGFzc2V0SUQ6QnVmZmVyLCBhbW91bnQ6Qk4sIGJ1cm46Qk4pID0+IHtcbiAgICAgIGxldCBhYTpBc3NldEFtb3VudCA9IG5ldyBBc3NldEFtb3VudChhc3NldElELCBhbW91bnQsIGJ1cm4pO1xuICAgICAgdGhpcy5hbW91bnRzLnB1c2goYWEpO1xuICAgICAgdGhpcy5hbW91bnRrZXlbYWEuZ2V0QXNzZXRJRFN0cmluZygpXSA9IGFhO1xuICAgIH1cbiAgXG4gICAgYWRkSW5wdXQgPSAoaW5wdXQ6VEkpID0+IHtcbiAgICAgIHRoaXMuaW5wdXRzLnB1c2goaW5wdXQpO1xuICAgIH1cbiAgXG4gICAgYWRkT3V0cHV0ID0gKG91dHB1dDpUTykgPT4ge1xuICAgICAgdGhpcy5vdXRwdXRzLnB1c2gob3V0cHV0KTtcbiAgICB9XG4gIFxuICAgIGFkZENoYW5nZSA9IChvdXRwdXQ6VE8pID0+IHtcbiAgICAgIHRoaXMuY2hhbmdlLnB1c2gob3V0cHV0KTtcbiAgICB9XG4gIFxuICAgIGdldEFtb3VudHMgPSAoKTpBcnJheTxBc3NldEFtb3VudD4gPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuYW1vdW50cztcbiAgICB9XG4gIFxuICAgIGdldERlc3RpbmF0aW9ucyA9ICgpOkFycmF5PEJ1ZmZlcj4gPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuZGVzdGluYXRpb25zO1xuICAgIH1cbiAgXG4gICAgZ2V0U2VuZGVycyA9ICgpOkFycmF5PEJ1ZmZlcj4gPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuc2VuZGVycztcbiAgICB9XG4gIFxuICAgIGdldENoYW5nZUFkZHJlc3NlcyA9ICgpOkFycmF5PEJ1ZmZlcj4gPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuY2hhbmdlQWRkcmVzc2VzO1xuICAgIH1cbiAgXG4gICAgZ2V0QXNzZXRBbW91bnQgPSAoYXNzZXRIZXhTdHI6c3RyaW5nKTpBc3NldEFtb3VudCA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5hbW91bnRrZXlbYXNzZXRIZXhTdHJdO1xuICAgIH1cbiAgXG4gICAgYXNzZXRFeGlzdHMgPSAoYXNzZXRIZXhTdHI6c3RyaW5nKTpib29sZWFuID0+IHtcbiAgICAgIHJldHVybiAoYXNzZXRIZXhTdHIgaW4gdGhpcy5hbW91bnRrZXkpO1xuICAgIH1cbiAgXG4gICAgZ2V0SW5wdXRzID0gKCk6QXJyYXk8VEk+ID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmlucHV0cztcbiAgICB9XG4gIFxuICAgIGdldE91dHB1dHMgPSAoKTpBcnJheTxUTz4gPT4ge1xuICAgICAgcmV0dXJuIHRoaXMub3V0cHV0cztcbiAgICB9XG4gIFxuICAgIGdldENoYW5nZU91dHB1dHMgPSAoKTpBcnJheTxUTz4gPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuY2hhbmdlO1xuICAgIH1cbiAgXG4gICAgZ2V0QWxsT3V0cHV0cyA9ICgpOkFycmF5PFRPPiA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5vdXRwdXRzLmNvbmNhdCh0aGlzLmNoYW5nZSk7XG4gICAgfVxuICBcbiAgICBjYW5Db21wbGV0ZSA9ICgpOmJvb2xlYW4gPT4ge1xuICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMuYW1vdW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZighdGhpcy5hbW91bnRzW2ldLmlzRmluaXNoZWQoKSkge1xuICBcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgXG4gICAgY29uc3RydWN0b3IoZGVzdGluYXRpb25zOkFycmF5PEJ1ZmZlcj4sIHNlbmRlcnM6QXJyYXk8QnVmZmVyPiwgY2hhbmdlQWRkcmVzc2VzOkFycmF5PEJ1ZmZlcj4pIHtcbiAgICAgIHRoaXMuZGVzdGluYXRpb25zID0gZGVzdGluYXRpb25zO1xuICAgICAgdGhpcy5jaGFuZ2VBZGRyZXNzZXMgPSBjaGFuZ2VBZGRyZXNzZXM7XG4gICAgICB0aGlzLnNlbmRlcnMgPSBzZW5kZXJzO1xuICAgIH1cbiAgXG4gIH0iXX0=