"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const keychain_1 = require("src/apis/avm/keychain");
const index_1 = require("src/index");
const buffer_1 = require("buffer/");
const create_hash_1 = __importDefault(require("create-hash"));
const bintools_1 = __importDefault(require("src/utils/bintools"));
const bintools = bintools_1.default.getInstance();
const alias = 'X';
const hrp = "tests";
describe('AVMKeyPair', () => {
    const networkid = 12345;
    const ip = '127.0.0.1';
    const port = 9650;
    const protocol = 'https';
    const avalanche = new index_1.Avalanche(ip, port, protocol, networkid, undefined, undefined, true);
    test('human readable part', () => {
        let hrp = avalanche.getHRP();
        let networkID = avalanche.getNetworkID();
        expect(hrp).toBe("local");
        expect(networkID).toBe(12345);
        avalanche.setNetworkID(2);
        hrp = avalanche.getHRP();
        networkID = avalanche.getNetworkID();
        expect(hrp).toBe("cascade");
        expect(networkID).toBe(2);
        avalanche.setNetworkID(3);
        hrp = avalanche.getHRP();
        networkID = avalanche.getNetworkID();
        expect(hrp).toBe("denali");
        expect(networkID).toBe(3);
        avalanche.setNetworkID(4);
        hrp = avalanche.getHRP();
        networkID = avalanche.getNetworkID();
        expect(hrp).toBe("everest");
        expect(networkID).toBe(4);
        avalanche.setNetworkID(0);
        hrp = avalanche.getHRP();
        networkID = avalanche.getNetworkID();
        expect(hrp).toBe("custom");
        expect(networkID).toBe(0);
        avalanche.setNetworkID(1);
        hrp = avalanche.getHRP();
        networkID = avalanche.getNetworkID();
        expect(hrp).toBe("avax");
        expect(networkID).toBe(1);
        avalanche.setNetworkID(12345);
        hrp = avalanche.getHRP();
        networkID = avalanche.getNetworkID();
        expect(hrp).toBe("local");
        expect(networkID).toBe(12345);
    });
    test('repeatable 1', () => {
        const kp = new keychain_1.KeyPair(hrp, alias);
        kp.importKey(buffer_1.Buffer.from('ef9bf2d4436491c153967c9709dd8e82795bdb9b5ad44ee22c2903005d1cf676', 'hex'));
        expect(kp.getPublicKey().toString('hex')).toBe('033fad3644deb20d7a210d12757092312451c112d04773cee2699fbb59dc8bb2ef');
        const msg = buffer_1.Buffer.from(create_hash_1.default('sha256').update(buffer_1.Buffer.from('09090909', 'hex')).digest('hex'), 'hex');
        const sig = kp.sign(msg);
        expect(sig.length).toBe(65);
        expect(kp.verify(msg, sig)).toBe(true);
        expect(kp.recover(msg, sig).toString('hex')).toBe(kp.getPublicKey().toString('hex'));
    });
    test('repeatable 2', () => {
        const kp = new keychain_1.KeyPair(hrp, alias);
        kp.importKey(buffer_1.Buffer.from('17c692d4a99d12f629d9f0ff92ec0dba15c9a83e85487b085c1a3018286995c6', 'hex'));
        expect(kp.getPublicKey().toString('hex')).toBe('02486553b276cfe7abf0efbcd8d173e55db9c03da020c33d0b219df24124da18ee');
        const msg = buffer_1.Buffer.from(create_hash_1.default('sha256').update(buffer_1.Buffer.from('09090909', 'hex')).digest('hex'), 'hex');
        const sig = kp.sign(msg);
        expect(sig.length).toBe(65);
        expect(kp.verify(msg, sig)).toBe(true);
        expect(kp.recover(msg, sig).toString('hex')).toBe(kp.getPublicKey().toString('hex'));
    });
    test('repeatable 3', () => {
        const kp = new keychain_1.KeyPair(hrp, alias);
        kp.importKey(buffer_1.Buffer.from('d0e17d4b31380f96a42b3e9ffc4c1b2a93589a1e51d86d7edc107f602fbc7475', 'hex'));
        expect(kp.getPublicKey().toString('hex')).toBe('031475b91d4fcf52979f1cf107f058088cc2bea6edd51915790f27185a7586e2f2');
        const msg = buffer_1.Buffer.from(create_hash_1.default('sha256').update(buffer_1.Buffer.from('09090909', 'hex')).digest('hex'), 'hex');
        const sig = kp.sign(msg);
        expect(sig.length).toBe(65);
        expect(kp.verify(msg, sig)).toBe(true);
        expect(kp.recover(msg, sig).toString('hex')).toBe(kp.getPublicKey().toString('hex'));
    });
    test('Creation Empty', () => {
        const kp = new keychain_1.KeyPair(hrp, alias);
        expect(kp.getPrivateKey()).not.toBeUndefined();
        expect(kp.getAddress()).not.toBeUndefined();
        expect(kp.getPrivateKeyString()).not.toBeUndefined();
        expect(kp.getPublicKey()).not.toBeUndefined();
        expect(kp.getPublicKeyString()).not.toBeUndefined();
        const msg = buffer_1.Buffer.from(create_hash_1.default('sha256').update(buffer_1.Buffer.from('09090909', 'hex')).digest('hex'), 'hex');
        const sig = kp.sign(msg);
        expect(sig.length).toBe(65);
        expect(kp.verify(msg, sig)).toBe(true);
        expect(kp.recover(msg, sig).toString('hex')).toBe(kp.getPublicKey().toString('hex'));
    });
});
describe('AVMKeyChain', () => {
    test('importKey from Buffer', () => {
        const keybuff = buffer_1.Buffer.from('d0e17d4b31380f96a42b3e9ffc4c1b2a93589a1e51d86d7edc107f602fbc7475', 'hex');
        const kc = new keychain_1.KeyChain(hrp, alias);
        const kp2 = new keychain_1.KeyPair(hrp, alias);
        const addr1 = kc.importKey(keybuff).getAddress();
        const kp1 = kc.getKey(addr1);
        kp2.importKey(keybuff);
        const addr2 = kp1.getAddress();
        expect(addr1.toString('hex')).toBe(addr2.toString('hex'));
        expect(kp1.getPrivateKeyString()).toBe(kp2.getPrivateKeyString());
        expect(kp1.getPublicKeyString()).toBe(kp2.getPublicKeyString());
        expect(kc.hasKey(addr1)).toBe(true);
    });
    test('importKey from Buffer with leading zeros', () => {
        const keybuff = buffer_1.Buffer.from('00007d4b31380f96a42b3e9ffc4c1b2a93589a1e51d86d7edc107f602fbc7475', 'hex');
        expect(keybuff.length).toBe(32);
        const kc = new keychain_1.KeyChain(hrp, alias);
        const kp2 = new keychain_1.KeyPair(hrp, alias);
        const addr1 = kc.importKey(keybuff).getAddress();
        const kp1 = kc.getKey(addr1);
        kp2.importKey(keybuff);
        const addr2 = kp1.getAddress();
        expect(addr1.toString('hex')).toBe(addr2.toString('hex'));
        expect(kp1.getPrivateKeyString()).toBe(kp2.getPrivateKeyString());
        expect(kp1.getPrivateKey().length).toBe(32);
        expect(kp2.getPrivateKey().length).toBe(32);
        expect(kp1.getPublicKeyString()).toBe(kp2.getPublicKeyString());
        expect(kp1.getPublicKey().length).toBe(33);
        expect(kp2.getPublicKey().length).toBe(33);
        expect(kc.hasKey(addr1)).toBe(true);
    });
    test('importKey from serialized string', () => {
        const keybuff = buffer_1.Buffer.from('d0e17d4b31380f96a42b3e9ffc4c1b2a93589a1e51d86d7edc107f602fbc7475', 'hex');
        const kc = new keychain_1.KeyChain(hrp, alias);
        const kp2 = new keychain_1.KeyPair(hrp, alias);
        const addr1 = kc.importKey("PrivateKey-" + bintools.cb58Encode(keybuff)).getAddress();
        const kp1 = kc.getKey(addr1);
        kp2.importKey(keybuff);
        const addr2 = kp1.getAddress();
        expect(addr1.toString('hex')).toBe(addr2.toString('hex'));
        expect(kp1.getPrivateKeyString()).toBe(kp2.getPrivateKeyString());
        expect(kp1.getPublicKeyString()).toBe(kp2.getPublicKeyString());
        expect(kc.hasKey(addr1)).toBe(true);
    });
    test('removeKey via keypair', () => {
        const keybuff = buffer_1.Buffer.from('d0e17d4b31380f96a42b3e9ffc4c1b2a93589a1e51d86d7edc107f602fbc7475', 'hex');
        const kc = new keychain_1.KeyChain(hrp, alias);
        const kp1 = new keychain_1.KeyPair(hrp, alias);
        const addr1 = kc.importKey(keybuff).getAddress();
        kp1.importKey(keybuff);
        expect(kc.hasKey(addr1)).toBe(true);
        kc.removeKey(kp1);
        expect(kc.hasKey(addr1)).toBe(false);
    });
    test('removeKey via string', () => {
        const keybuff = buffer_1.Buffer.from('d0e17d4b31380f96a42b3e9ffc4c1b2a93589a1e51d86d7edc107f602fbc7475', 'hex');
        const kc = new keychain_1.KeyChain(hrp, alias);
        const addr1 = kc.importKey(keybuff).getAddress();
        expect(kc.hasKey(addr1)).toBe(true);
        kc.removeKey(addr1);
        expect(kc.hasKey(addr1)).toBe(false);
    });
    test('removeKey bad keys', () => {
        const keybuff = buffer_1.Buffer.from('d0e17d4b31380f96a42b3e9ffc4c1b2a93589a1e51d86d7edc107f602fbc7475', 'hex');
        const kc = new keychain_1.KeyChain(hrp, alias);
        const addr1 = kc.importKey(keybuff).getAddress();
        expect(kc.hasKey(addr1)).toBe(true);
        expect(kc.removeKey(bintools.cb58Decode('6Y3kysjF9jnHnYkdS9yGAuoHyae2eNmeV'))).toBe(false);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2V5Y2hhaW4udGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3RzL2FwaXMvYXZtL2tleWNoYWluLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxvREFBMEQ7QUFDMUQscUNBQXFDO0FBQ3JDLG9DQUFpQztBQUNqQyw4REFBcUM7QUFDckMsa0VBQTBDO0FBRTFDLE1BQU0sUUFBUSxHQUFHLGtCQUFRLENBQUMsV0FBVyxFQUFFLENBQUM7QUFDeEMsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDO0FBQ2xCLE1BQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQTtBQUVuQixRQUFRLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTtJQUMxQixNQUFNLFNBQVMsR0FBVSxLQUFLLENBQUM7SUFDL0IsTUFBTSxFQUFFLEdBQVUsV0FBVyxDQUFDO0lBQzlCLE1BQU0sSUFBSSxHQUFVLElBQUksQ0FBQztJQUN6QixNQUFNLFFBQVEsR0FBVSxPQUFPLENBQUM7SUFDaEMsTUFBTSxTQUFTLEdBQWEsSUFBSSxpQkFBUyxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBRXJHLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7UUFDL0IsSUFBSSxHQUFHLEdBQVUsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3BDLElBQUksU0FBUyxHQUFVLFNBQVMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNoRCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzFCLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFOUIsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQixHQUFHLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3pCLFNBQVMsR0FBRyxTQUFTLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDckMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM1QixNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTFCLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUIsR0FBRyxHQUFHLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUN6QixTQUFTLEdBQUcsU0FBUyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3JDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDM0IsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUUxQixTQUFTLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFCLEdBQUcsR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDekIsU0FBUyxHQUFHLFNBQVMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNyQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzVCLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFMUIsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQixHQUFHLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3pCLFNBQVMsR0FBRyxTQUFTLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDckMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMzQixNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTFCLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxD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LENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDMUQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLENBQUM7UUFDbEUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDNUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDNUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLENBQUM7UUFDaEUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDM0MsTUFBTSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDM0MsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdEMsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsa0NBQWtDLEVBQUUsR0FBRyxFQUFFO1FBQzVDLE1BQU0sT0FBTyxHQUFVLGVBQU0sQ0FBQyxJQUFJLENBQUMsa0VBQWtFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDOUcsTUFBTSxFQUFFLEdBQVksSUFBSSxtQkFBUSxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUM3QyxNQUFNLEdBQUcsR0FBVyxJQUFJLGtCQUFPLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzVDLE1BQU0sS0FBSyxHQUFVLEVBQUUsQ0FBQyxTQUFTLENBQUMsYUFBYSxHQUFHLFFBQVEsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUM3RixNQUFNLEdBQUcsR0FBVyxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JDLEdBQUcsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdkIsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQy9CLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUMxRCxNQUFNLENBQUMsR0FBRyxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQztRQUNsRSxNQUFNLENBQUMsR0FBRyxDQUFDLGtCQUFrQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLGtCQUFrQixFQUFFLENBQUMsQ0FBQztRQUNoRSxNQUFNLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN0QyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7UUFDakMsTUFBTSxPQUFPLEdBQVUsZUFBTSxDQUFDLElBQUksQ0FBQyxrRUFBa0UsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUM5RyxNQUFNLEVBQUUsR0FBWSxJQUFJLG1CQUFRLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzdDLE1BQU0sR0FBRyxHQUFXLElBQUksa0JBQU8sQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDNUMsTUFBTSxLQUFLLEdBQVUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUN4RCxHQUFHLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3ZCLE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BDLEVBQUUsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbEIsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO1FBQ2hDLE1BQU0sT0FBTyxHQUFVLGVBQU0sQ0FBQyxJQUFJLENBQUMsa0VBQWtFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDOUcsTUFBTSxFQUFFLEdBQVksSUFBSSxtQkFBUSxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUM3QyxNQUFNLEtBQUssR0FBVSxFQUFFLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3hELE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BDLEVBQUUsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDcEIsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO1FBQzlCLE1BQU0sT0FBTyxHQUFVLGVBQU0sQ0FBQyxJQUFJLENBQUMsa0VBQWtFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDOUcsTUFBTSxFQUFFLEdBQVksSUFBSSxtQkFBUSxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUM3QyxNQUFNLEtBQUssR0FBVSxFQUFFLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3hELE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsbUNBQW1DLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdGLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBLZXlDaGFpbiwgS2V5UGFpciB9IGZyb20gJ3NyYy9hcGlzL2F2bS9rZXljaGFpbic7XG5pbXBvcnQgeyBBdmFsYW5jaGUgfSBmcm9tICdzcmMvaW5kZXgnXG5pbXBvcnQgeyBCdWZmZXIgfSBmcm9tICdidWZmZXIvJztcbmltcG9ydCBjcmVhdGVIYXNoIGZyb20gJ2NyZWF0ZS1oYXNoJztcbmltcG9ydCBCaW5Ub29scyBmcm9tICdzcmMvdXRpbHMvYmludG9vbHMnO1xuXG5jb25zdCBiaW50b29scyA9IEJpblRvb2xzLmdldEluc3RhbmNlKCk7XG5jb25zdCBhbGlhcyA9ICdYJztcbmNvbnN0IGhycCA9IFwidGVzdHNcIlxuXG5kZXNjcmliZSgnQVZNS2V5UGFpcicsICgpID0+IHtcbiAgY29uc3QgbmV0d29ya2lkOm51bWJlciA9IDEyMzQ1O1xuICBjb25zdCBpcDpzdHJpbmcgPSAnMTI3LjAuMC4xJztcbiAgY29uc3QgcG9ydDpudW1iZXIgPSA5NjUwO1xuICBjb25zdCBwcm90b2NvbDpzdHJpbmcgPSAnaHR0cHMnO1xuICBjb25zdCBhdmFsYW5jaGU6QXZhbGFuY2hlID0gbmV3IEF2YWxhbmNoZShpcCwgcG9ydCwgcHJvdG9jb2wsIG5ldHdvcmtpZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHRydWUpO1xuXG4gIHRlc3QoJ2h1bWFuIHJlYWRhYmxlIHBhcnQnLCAoKSA9PiB7XG4gICAgbGV0IGhycDpzdHJpbmcgPSBhdmFsYW5jaGUuZ2V0SFJQKCk7XG4gICAgbGV0IG5ldHdvcmtJRDpudW1iZXIgPSBhdmFsYW5jaGUuZ2V0TmV0d29ya0lEKCk7XG4gICAgZXhwZWN0KGhycCkudG9CZShcImxvY2FsXCIpO1xuICAgIGV4cGVjdChuZXR3b3JrSUQpLnRvQmUoMTIzNDUpO1xuXG4gICAgYXZhbGFuY2hlLnNldE5ldHdvcmtJRCgyKTtcbiAgICBocnAgPSBhdmFsYW5jaGUuZ2V0SFJQKCk7XG4gICAgbmV0d29ya0lEID0gYXZhbGFuY2hlLmdldE5ldHdvcmtJRCgpO1xuICAgIGV4cGVjdChocnApLnRvQmUoXCJjYXNjYWRlXCIpO1xuICAgIGV4cGVjdChuZXR3b3JrSUQpLnRvQmUoMik7XG5cbiAgICBhdmFsYW5jaGUuc2V0TmV0d29ya0lEKDMpO1xuICAgIGhycCA9IGF2YWxhbmNoZS5nZXRIUlAoKTtcbiAgICBuZXR3b3JrSUQgPSBhdmFsYW5jaGUuZ2V0TmV0d29ya0lEKCk7XG4gICAgZXhwZWN0KGhycCkudG9CZShcImRlbmFsaVwiKTtcbiAgICBleHBlY3QobmV0d29ya0lEKS50b0JlKDMpO1xuXG4gICAgYXZhbGFuY2hlLnNldE5ldHdvcmtJRCg0KTtcbiAgICBocnAgPSBhdmFsYW5jaGUuZ2V0SFJQKCk7XG4gICAgbmV0d29ya0lEID0gYXZhbGFuY2hlLmdldE5ldHdvcmtJRCgpO1xuICAgIGV4cGVjdChocnApLnRvQmUoXCJldmVyZXN0XCIpO1xuICAgIGV4cGVjdChuZXR3b3JrSUQpLnRvQmUoNCk7XG5cbiAgICBhdmFsYW5jaGUuc2V0TmV0d29ya0lEKDApO1xuICAgIGhycCA9IGF2YWxhbmNoZS5nZXRIUlAoKTtcbiAgICBuZXR3b3JrSUQgPSBhdmFsYW5jaGUuZ2V0TmV0d29ya0lEKCk7XG4gICAgZXhwZWN0KGhycCkudG9CZShcImN1c3RvbVwiKTtcbiAgICBleHBlY3QobmV0d29ya0lEKS50b0JlKDApO1xuXG4gICAgYXZhbGFuY2hlLnNldE5ldHdvcmtJRCgxKTtcbiAgICBocnAgPSBhdmFsYW5jaGUuZ2V0SFJQKCk7XG4gICAgbmV0d29ya0lEID0gYXZhbGFuY2hlLmdldE5ldHdvcmtJRCgpO1xuICAgIGV4cGVjdChocnApLnRvQmUoXCJhdmF4XCIpO1xuICAgIGV4cGVjdChuZXR3b3JrSUQpLnRvQmUoMSk7XG5cbiAgICBhdmFsYW5jaGUuc2V0TmV0d29ya0lEKDEyMzQ1KTtcbiAgICBocnAgPSBhdmFsYW5jaGUuZ2V0SFJQKCk7XG4gICAgbmV0d29ya0lEID0gYXZhbGFuY2hlLmdldE5ldHdvcmtJRCgpO1xuICAgIGV4cGVjdChocnApLnRvQmUoXCJsb2NhbFwiKTtcbiAgICBleHBlY3QobmV0d29ya0lEKS50b0JlKDEyMzQ1KTtcbiAgfSk7XG5cbiAgdGVzdCgncmVwZWF0YWJsZSAxJywgKCkgPT4ge1xuICAgIGNvbnN0IGtwOktleVBhaXIgPSBuZXcgS2V5UGFpcihocnAsIGFsaWFzKTtcbiAgICBrcC5pbXBvcnRLZXkoQnVmZmVyLmZyb20oJ2VmOWJmMmQ0NDM2NDkxYzE1Mzk2N2M5NzA5ZGQ4ZTgyNzk1YmRiOWI1YWQ0NGVlMjJjMjkwMzAwNWQxY2Y2NzYnLCAnaGV4JykpO1xuICAgIGV4cGVjdChrcC5nZXRQdWJsaWNLZXkoKS50b1N0cmluZygnaGV4JykpLnRvQmUoJzAzM2ZhZDM2NDRkZWIyMGQ3YTIxMGQxMjc1NzA5MjMxMjQ1MWMxMTJkMDQ3NzNjZWUyNjk5ZmJiNTlkYzhiYjJlZicpO1xuXG4gICAgY29uc3QgbXNnOkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZShCdWZmZXIuZnJvbSgnMDkwOTA5MDknLCAnaGV4JykpLmRpZ2VzdCgnaGV4JyksICdoZXgnKTtcbiAgICBjb25zdCBzaWc6QnVmZmVyID0ga3Auc2lnbihtc2cpO1xuXG4gICAgZXhwZWN0KHNpZy5sZW5ndGgpLnRvQmUoNjUpO1xuICAgIGV4cGVjdChrcC52ZXJpZnkobXNnLCBzaWcpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChrcC5yZWNvdmVyKG1zZywgc2lnKS50b1N0cmluZygnaGV4JykpLnRvQmUoa3AuZ2V0UHVibGljS2V5KCkudG9TdHJpbmcoJ2hleCcpKTtcbiAgfSk7XG5cbiAgdGVzdCgncmVwZWF0YWJsZSAyJywgKCkgPT4ge1xuICAgIGNvbnN0IGtwOktleVBhaXIgPSBuZXcgS2V5UGFpcihocnAsIGFsaWFzKTtcbiAgICBrcC5pbXBvcnRLZXkoQnVmZmVyLmZyb20oJzE3YzY5MmQ0YTk5ZDEyZjYyOWQ5ZjBmZjkyZWMwZGJhMTVjOWE4M2U4NTQ4N2IwODVjMWEzMDE4Mjg2OTk1YzYnLCAnaGV4JykpO1xuICAgIGV4cGVjdChrcC5nZXRQdWJsaWNLZXkoKS50b1N0cmluZygnaGV4JykpLnRvQmUoJzAyNDg2NTUzYjI3NmNmZTdhYmYwZWZiY2Q4ZDE3M2U1NWRiOWMwM2RhMDIwYzMzZDBiMjE5ZGYyNDEyNGRhMThlZScpO1xuXG4gICAgY29uc3QgbXNnOkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZShCdWZmZXIuZnJvbSgnMDkwOTA5MDknLCAnaGV4JykpLmRpZ2VzdCgnaGV4JyksICdoZXgnKTtcbiAgICBjb25zdCBzaWc6QnVmZmVyID0ga3Auc2lnbihtc2cpO1xuXG4gICAgZXhwZWN0KHNpZy5sZW5ndGgpLnRvQmUoNjUpO1xuICAgIGV4cGVjdChrcC52ZXJpZnkobXNnLCBzaWcpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChrcC5yZWNvdmVyKG1zZywgc2lnKS50b1N0cmluZygnaGV4JykpLnRvQmUoa3AuZ2V0UHVibGljS2V5KCkudG9TdHJpbmcoJ2hleCcpKTtcbiAgfSk7XG5cbiAgdGVzdCgncmVwZWF0YWJsZSAzJywgKCkgPT4ge1xuICAgIGNvbnN0IGtwOktleVBhaXIgPSBuZXcgS2V5UGFpcihocnAsIGFsaWFzKTtcbiAgICBrcC5pbXBvcnRLZXkoQnVmZmVyLmZyb20oJ2QwZTE3ZDRiMzEzODBmOTZhNDJiM2U5ZmZjNGMxYjJhOTM1ODlhMWU1MWQ4NmQ3ZWRjMTA3ZjYwMmZiYzc0NzUnLCAnaGV4JykpO1xuICAgIGV4cGVjdChrcC5nZXRQdWJsaWNLZXkoKS50b1N0cmluZygnaGV4JykpLnRvQmUoJzAzMTQ3NWI5MWQ0ZmNmNTI5NzlmMWNmMTA3ZjA1ODA4OGNjMmJlYTZlZGQ1MTkxNTc5MGYyNzE4NWE3NTg2ZTJmMicpO1xuXG4gICAgY29uc3QgbXNnOkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZShCdWZmZXIuZnJvbSgnMDkwOTA5MDknLCAnaGV4JykpLmRpZ2VzdCgnaGV4JyksICdoZXgnKTtcbiAgICBjb25zdCBzaWc6QnVmZmVyID0ga3Auc2lnbihtc2cpO1xuXG4gICAgZXhwZWN0KHNpZy5sZW5ndGgpLnRvQmUoNjUpO1xuICAgIGV4cGVjdChrcC52ZXJpZnkobXNnLCBzaWcpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChrcC5yZWNvdmVyKG1zZywgc2lnKS50b1N0cmluZygnaGV4JykpLnRvQmUoa3AuZ2V0UHVibGljS2V5KCkudG9TdHJpbmcoJ2hleCcpKTtcbiAgfSk7XG5cbiAgdGVzdCgnQ3JlYXRpb24gRW1wdHknLCAoKSA9PiB7XG4gICAgY29uc3Qga3A6S2V5UGFpciA9IG5ldyBLZXlQYWlyKGhycCwgYWxpYXMpO1xuICAgIGV4cGVjdChrcC5nZXRQcml2YXRlS2V5KCkpLm5vdC50b0JlVW5kZWZpbmVkKCk7XG4gICAgZXhwZWN0KGtwLmdldEFkZHJlc3MoKSkubm90LnRvQmVVbmRlZmluZWQoKTtcbiAgICBleHBlY3Qoa3AuZ2V0UHJpdmF0ZUtleVN0cmluZygpKS5ub3QudG9CZVVuZGVmaW5lZCgpO1xuICAgIGV4cGVjdChrcC5nZXRQdWJsaWNLZXkoKSkubm90LnRvQmVVbmRlZmluZWQoKTtcbiAgICBleHBlY3Qoa3AuZ2V0UHVibGljS2V5U3RyaW5nKCkpLm5vdC50b0JlVW5kZWZpbmVkKCk7XG4gICAgY29uc3QgbXNnOkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZShCdWZmZXIuZnJvbSgnMDkwOTA5MDknLCAnaGV4JykpLmRpZ2VzdCgnaGV4JyksICdoZXgnKTtcbiAgICBjb25zdCBzaWc6QnVmZmVyID0ga3Auc2lnbihtc2cpO1xuXG4gICAgZXhwZWN0KHNpZy5sZW5ndGgpLnRvQmUoNjUpO1xuICAgIGV4cGVjdChrcC52ZXJpZnkobXNnLCBzaWcpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChrcC5yZWNvdmVyKG1zZywgc2lnKS50b1N0cmluZygnaGV4JykpLnRvQmUoa3AuZ2V0UHVibGljS2V5KCkudG9TdHJpbmcoJ2hleCcpKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ0FWTUtleUNoYWluJywgKCkgPT4ge1xuICB0ZXN0KCdpbXBvcnRLZXkgZnJvbSBCdWZmZXInLCAoKSA9PiB7XG4gICAgY29uc3Qga2V5YnVmZjpCdWZmZXIgPSBCdWZmZXIuZnJvbSgnZDBlMTdkNGIzMTM4MGY5NmE0MmIzZTlmZmM0YzFiMmE5MzU4OWExZTUxZDg2ZDdlZGMxMDdmNjAyZmJjNzQ3NScsICdoZXgnKTtcbiAgICBjb25zdCBrYzpLZXlDaGFpbiA9IG5ldyBLZXlDaGFpbihocnAsIGFsaWFzKTtcbiAgICBjb25zdCBrcDI6S2V5UGFpciA9IG5ldyBLZXlQYWlyKGhycCwgYWxpYXMpO1xuICAgIGNvbnN0IGFkZHIxOkJ1ZmZlciA9IGtjLmltcG9ydEtleShrZXlidWZmKS5nZXRBZGRyZXNzKCk7XG4gICAgY29uc3Qga3AxOktleVBhaXIgPSBrYy5nZXRLZXkoYWRkcjEpO1xuICAgIGtwMi5pbXBvcnRLZXkoa2V5YnVmZik7XG4gICAgY29uc3QgYWRkcjIgPSBrcDEuZ2V0QWRkcmVzcygpO1xuICAgIGV4cGVjdChhZGRyMS50b1N0cmluZygnaGV4JykpLnRvQmUoYWRkcjIudG9TdHJpbmcoJ2hleCcpKTtcbiAgICBleHBlY3Qoa3AxLmdldFByaXZhdGVLZXlTdHJpbmcoKSkudG9CZShrcDIuZ2V0UHJpdmF0ZUtleVN0cmluZygpKTtcbiAgICBleHBlY3Qoa3AxLmdldFB1YmxpY0tleVN0cmluZygpKS50b0JlKGtwMi5nZXRQdWJsaWNLZXlTdHJpbmcoKSk7XG4gICAgZXhwZWN0KGtjLmhhc0tleShhZGRyMSkpLnRvQmUodHJ1ZSk7XG4gIH0pO1xuXG5cbiAgdGVzdCgnaW1wb3J0S2V5IGZyb20gQnVmZmVyIHdpdGggbGVhZGluZyB6ZXJvcycsICgpID0+IHtcbiAgICBjb25zdCBrZXlidWZmOkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKCcwMDAwN2Q0YjMxMzgwZjk2YTQyYjNlOWZmYzRjMWIyYTkzNTg5YTFlNTFkODZkN2VkYzEwN2Y2MDJmYmM3NDc1JywgJ2hleCcpO1xuICAgIGV4cGVjdChrZXlidWZmLmxlbmd0aCkudG9CZSgzMik7XG4gICAgY29uc3Qga2M6S2V5Q2hhaW4gPSBuZXcgS2V5Q2hhaW4oaHJwLCBhbGlhcyk7XG4gICAgY29uc3Qga3AyOktleVBhaXIgPSBuZXcgS2V5UGFpcihocnAsIGFsaWFzKTtcbiAgICBjb25zdCBhZGRyMTpCdWZmZXIgPSBrYy5pbXBvcnRLZXkoa2V5YnVmZikuZ2V0QWRkcmVzcygpO1xuICAgIGNvbnN0IGtwMTpLZXlQYWlyID0ga2MuZ2V0S2V5KGFkZHIxKTtcbiAgICBrcDIuaW1wb3J0S2V5KGtleWJ1ZmYpO1xuICAgIGNvbnN0IGFkZHIyID0ga3AxLmdldEFkZHJlc3MoKTtcbiAgICBleHBlY3QoYWRkcjEudG9TdHJpbmcoJ2hleCcpKS50b0JlKGFkZHIyLnRvU3RyaW5nKCdoZXgnKSk7XG4gICAgZXhwZWN0KGtwMS5nZXRQcml2YXRlS2V5U3RyaW5nKCkpLnRvQmUoa3AyLmdldFByaXZhdGVLZXlTdHJpbmcoKSk7XG4gICAgZXhwZWN0KGtwMS5nZXRQcml2YXRlS2V5KCkubGVuZ3RoKS50b0JlKDMyKTtcbiAgICBleHBlY3Qoa3AyLmdldFByaXZhdGVLZXkoKS5sZW5ndGgpLnRvQmUoMzIpO1xuICAgIGV4cGVjdChrcDEuZ2V0UHVibGljS2V5U3RyaW5nKCkpLnRvQmUoa3AyLmdldFB1YmxpY0tleVN0cmluZygpKTtcbiAgICBleHBlY3Qoa3AxLmdldFB1YmxpY0tleSgpLmxlbmd0aCkudG9CZSgzMyk7XG4gICAgZXhwZWN0KGtwMi5nZXRQdWJsaWNLZXkoKS5sZW5ndGgpLnRvQmUoMzMpO1xuICAgIGV4cGVjdChrYy5oYXNLZXkoYWRkcjEpKS50b0JlKHRydWUpO1xuICB9KTtcblxuICB0ZXN0KCdpbXBvcnRLZXkgZnJvbSBzZXJpYWxpemVkIHN0cmluZycsICgpID0+IHtcbiAgICBjb25zdCBrZXlidWZmOkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKCdkMGUxN2Q0YjMxMzgwZjk2YTQyYjNlOWZmYzRjMWIyYTkzNTg5YTFlNTFkODZkN2VkYzEwN2Y2MDJmYmM3NDc1JywgJ2hleCcpO1xuICAgIGNvbnN0IGtjOktleUNoYWluID0gbmV3IEtleUNoYWluKGhycCwgYWxpYXMpO1xuICAgIGNvbnN0IGtwMjpLZXlQYWlyID0gbmV3IEtleVBhaXIoaHJwLCBhbGlhcyk7XG4gICAgY29uc3QgYWRkcjE6QnVmZmVyID0ga2MuaW1wb3J0S2V5KFwiUHJpdmF0ZUtleS1cIiArIGJpbnRvb2xzLmNiNThFbmNvZGUoa2V5YnVmZikpLmdldEFkZHJlc3MoKTtcbiAgICBjb25zdCBrcDE6S2V5UGFpciA9IGtjLmdldEtleShhZGRyMSk7XG4gICAga3AyLmltcG9ydEtleShrZXlidWZmKTtcbiAgICBjb25zdCBhZGRyMiA9IGtwMS5nZXRBZGRyZXNzKCk7XG4gICAgZXhwZWN0KGFkZHIxLnRvU3RyaW5nKCdoZXgnKSkudG9CZShhZGRyMi50b1N0cmluZygnaGV4JykpO1xuICAgIGV4cGVjdChrcDEuZ2V0UHJpdmF0ZUtleVN0cmluZygpKS50b0JlKGtwMi5nZXRQcml2YXRlS2V5U3RyaW5nKCkpO1xuICAgIGV4cGVjdChrcDEuZ2V0UHVibGljS2V5U3RyaW5nKCkpLnRvQmUoa3AyLmdldFB1YmxpY0tleVN0cmluZygpKTtcbiAgICBleHBlY3Qoa2MuaGFzS2V5KGFkZHIxKSkudG9CZSh0cnVlKTtcbiAgfSk7XG5cbiAgdGVzdCgncmVtb3ZlS2V5IHZpYSBrZXlwYWlyJywgKCkgPT4ge1xuICAgIGNvbnN0IGtleWJ1ZmY6QnVmZmVyID0gQnVmZmVyLmZyb20oJ2QwZTE3ZDRiMzEzODBmOTZhNDJiM2U5ZmZjNGMxYjJhOTM1ODlhMWU1MWQ4NmQ3ZWRjMTA3ZjYwMmZiYzc0NzUnLCAnaGV4Jyk7XG4gICAgY29uc3Qga2M6S2V5Q2hhaW4gPSBuZXcgS2V5Q2hhaW4oaHJwLCBhbGlhcyk7XG4gICAgY29uc3Qga3AxOktleVBhaXIgPSBuZXcgS2V5UGFpcihocnAsIGFsaWFzKTtcbiAgICBjb25zdCBhZGRyMTpCdWZmZXIgPSBrYy5pbXBvcnRLZXkoa2V5YnVmZikuZ2V0QWRkcmVzcygpO1xuICAgIGtwMS5pbXBvcnRLZXkoa2V5YnVmZik7XG4gICAgZXhwZWN0KGtjLmhhc0tleShhZGRyMSkpLnRvQmUodHJ1ZSk7XG4gICAga2MucmVtb3ZlS2V5KGtwMSk7XG4gICAgZXhwZWN0KGtjLmhhc0tleShhZGRyMSkpLnRvQmUoZmFsc2UpO1xuICB9KTtcblxuICB0ZXN0KCdyZW1vdmVLZXkgdmlhIHN0cmluZycsICgpID0+IHtcbiAgICBjb25zdCBrZXlidWZmOkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKCdkMGUxN2Q0YjMxMzgwZjk2YTQyYjNlOWZmYzRjMWIyYTkzNTg5YTFlNTFkODZkN2VkYzEwN2Y2MDJmYmM3NDc1JywgJ2hleCcpO1xuICAgIGNvbnN0IGtjOktleUNoYWluID0gbmV3IEtleUNoYWluKGhycCwgYWxpYXMpO1xuICAgIGNvbnN0IGFkZHIxOkJ1ZmZlciA9IGtjLmltcG9ydEtleShrZXlidWZmKS5nZXRBZGRyZXNzKCk7XG4gICAgZXhwZWN0KGtjLmhhc0tleShhZGRyMSkpLnRvQmUodHJ1ZSk7XG4gICAga2MucmVtb3ZlS2V5KGFkZHIxKTtcbiAgICBleHBlY3Qoa2MuaGFzS2V5KGFkZHIxKSkudG9CZShmYWxzZSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JlbW92ZUtleSBiYWQga2V5cycsICgpID0+IHtcbiAgICBjb25zdCBrZXlidWZmOkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKCdkMGUxN2Q0YjMxMzgwZjk2YTQyYjNlOWZmYzRjMWIyYTkzNTg5YTFlNTFkODZkN2VkYzEwN2Y2MDJmYmM3NDc1JywgJ2hleCcpO1xuICAgIGNvbnN0IGtjOktleUNoYWluID0gbmV3IEtleUNoYWluKGhycCwgYWxpYXMpO1xuICAgIGNvbnN0IGFkZHIxOkJ1ZmZlciA9IGtjLmltcG9ydEtleShrZXlidWZmKS5nZXRBZGRyZXNzKCk7XG4gICAgZXhwZWN0KGtjLmhhc0tleShhZGRyMSkpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KGtjLnJlbW92ZUtleShiaW50b29scy5jYjU4RGVjb2RlKCc2WTNreXNqRjlqbkhuWWtkUzl5R0F1b0h5YWUyZU5tZVYnKSkpLnRvQmUoZmFsc2UpO1xuICB9KTtcbn0pO1xuIl19