"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jest_mock_axios_1 = __importDefault(require("jest-mock-axios"));
const src_1 = require("src");
const api_1 = require("src/apis/avm/api");
const api_2 = require("src/apis/admin/api");
const api_3 = require("src/apis/health/api");
const api_4 = require("src/apis/info/api");
const api_5 = require("src/apis/keystore/api");
const api_6 = require("src/apis/metrics/api");
const api_7 = require("src/apis/platformvm/api");
const testlib_1 = require("./testlib");
describe('Avalanche', () => {
    const blockchainid = "6h2s5de1VC65meajE1L2PjvZ1MXvHc3F6eqPCGKuDt4MxiweF";
    const ip = '127.0.0.1';
    const port = 9650;
    const protocol = "https";
    let avalanche;
    beforeAll(() => {
        avalanche = new src_1.Avalanche(ip, port, protocol, 12345, undefined, undefined, true);
        avalanche.addAPI("admin", api_2.AdminAPI);
        avalanche.addAPI("xchain", api_1.AVMAPI, "/ext/subnet/avm", blockchainid);
        avalanche.addAPI("health", api_3.HealthAPI);
        avalanche.addAPI("info", api_4.InfoAPI);
        avalanche.addAPI("keystore", api_5.KeystoreAPI);
        avalanche.addAPI("metrics", api_6.MetricsAPI);
        avalanche.addAPI("pchain", api_7.PlatformVMAPI);
    });
    test('Can initialize', () => {
        expect(avalanche.getIP()).toBe(ip);
        expect(avalanche.getPort()).toBe(port);
        expect(avalanche.getProtocol()).toBe(protocol);
        expect(avalanche.getURL()).toBe(`${protocol}://${ip}:${port}`);
        expect(avalanche.getNetworkID()).toBe(12345);
        avalanche.setNetworkID(50);
        expect(avalanche.getNetworkID()).toBe(50);
        avalanche.setNetworkID(12345);
        expect(avalanche.getNetworkID()).toBe(12345);
    });
    test('Endpoints correct', () => {
        expect(avalanche.Admin()).not.toBeInstanceOf(api_1.AVMAPI);
        expect(avalanche.Admin()).toBeInstanceOf(api_2.AdminAPI);
        expect(avalanche.XChain()).not.toBeInstanceOf(api_2.AdminAPI);
        expect(avalanche.XChain()).toBeInstanceOf(api_1.AVMAPI);
        expect(avalanche.Health()).not.toBeInstanceOf(api_5.KeystoreAPI);
        expect(avalanche.Health()).toBeInstanceOf(api_3.HealthAPI);
        expect(avalanche.Info()).not.toBeInstanceOf(api_5.KeystoreAPI);
        expect(avalanche.Info()).toBeInstanceOf(api_4.InfoAPI);
        expect(avalanche.PChain()).not.toBeInstanceOf(api_5.KeystoreAPI);
        expect(avalanche.PChain()).toBeInstanceOf(api_7.PlatformVMAPI);
        expect(avalanche.NodeKeys()).not.toBeInstanceOf(api_7.PlatformVMAPI);
        expect(avalanche.NodeKeys()).toBeInstanceOf(api_5.KeystoreAPI);
        expect(avalanche.Metrics()).not.toBeInstanceOf(api_5.KeystoreAPI);
        expect(avalanche.Metrics()).toBeInstanceOf(api_6.MetricsAPI);
        expect(avalanche.Admin().getRPCID()).toBe(1);
        expect(avalanche.XChain().getRPCID()).toBe(1);
        expect(avalanche.PChain().getRPCID()).toBe(1);
        expect(avalanche.NodeKeys().getRPCID()).toBe(1);
    });
    test('Create new API', () => {
        avalanche.addAPI("avm2", api_1.AVMAPI);
        expect(avalanche.api("avm2")).toBeInstanceOf(api_1.AVMAPI);
        avalanche.addAPI("keystore2", api_5.KeystoreAPI, "/ext/keystore2");
        expect(avalanche.api("keystore2")).toBeInstanceOf(api_5.KeystoreAPI);
        avalanche.api("keystore2").setBaseURL("/ext/keystore3");
        expect(avalanche.api("keystore2").getBaseURL()).toBe("/ext/keystore3");
        expect(avalanche.api("keystore2").getDB()).toHaveProperty("namespace");
    });
});
describe('HTTP Operations', () => {
    const ip = '127.0.0.1';
    const port = 8080;
    const protocol = 'http';
    const path = '/ext/testingrequests';
    let avalanche;
    beforeAll(() => {
        avalanche = new src_1.Avalanche(ip, port, protocol, 12345, undefined, undefined, true);
        avalanche.addAPI('testingrequests', testlib_1.TestAPI, path);
    });
    afterEach(() => {
        jest_mock_axios_1.default.reset();
    });
    test('GET works', () => __awaiter(void 0, void 0, void 0, function* () {
        const input = 'TestGET';
        const api = avalanche.api('testingrequests');
        const result = api.TestGET(input, `/${input}`);
        const payload = {
            result: {
                output: input,
            },
        };
        const responseObj = {
            data: payload,
        };
        jest_mock_axios_1.default.mockResponse(responseObj);
        const response = yield result;
        expect(jest_mock_axios_1.default.request).toHaveBeenCalledTimes(1);
        expect(response.output).toBe(input);
    }));
    test('DELETE works', () => __awaiter(void 0, void 0, void 0, function* () {
        const input = 'TestDELETE';
        const api = avalanche.api('testingrequests');
        const axiosConfig = {
            baseURL: `${protocol}://${ip}:${port}`,
            responseType: 'text',
        };
        const result = api.TestDELETE(input, `/${input}`, axiosConfig);
        const payload = {
            result: {
                output: input,
            },
        };
        const responseObj = {
            data: payload,
        };
        jest_mock_axios_1.default.mockResponse(responseObj);
        const response = yield result;
        expect(jest_mock_axios_1.default.request).toHaveBeenCalledTimes(1);
        expect(response.output).toBe(input);
    }));
    test('POST works', () => __awaiter(void 0, void 0, void 0, function* () {
        const input = 'TestPOST';
        const api = avalanche.api('testingrequests');
        const result = api.TestPOST(input, `/${input}`);
        const payload = {
            result: {
                output: input,
            },
        };
        const responseObj = {
            data: payload,
        };
        jest_mock_axios_1.default.mockResponse(responseObj);
        const response = yield result;
        expect(jest_mock_axios_1.default.request).toHaveBeenCalledTimes(1);
        expect(response.output).toBe(input);
    }));
    test('PUT works', () => __awaiter(void 0, void 0, void 0, function* () {
        const input = 'TestPUT';
        const api = avalanche.api('testingrequests');
        const result = api.TestPUT(input, `/${input}`);
        const payload = {
            result: {
                output: input,
            },
        };
        const responseObj = {
            data: payload,
        };
        jest_mock_axios_1.default.mockResponse(responseObj);
        const response = yield result;
        expect(jest_mock_axios_1.default.request).toHaveBeenCalledTimes(1);
        expect(response.output).toBe(input);
    }));
    test('PATCH works', () => __awaiter(void 0, void 0, void 0, function* () {
        const input = 'TestPATCH';
        const api = avalanche.api('testingrequests');
        const result = api.TestPATCH(input, `/${input}`);
        const payload = {
            result: {
                output: input,
            },
        };
        const responseObj = {
            data: payload,
        };
        jest_mock_axios_1.default.mockResponse(responseObj);
        const response = yield result;
        expect(jest_mock_axios_1.default.request).toHaveBeenCalledTimes(1);
        expect(response.output).toBe(input);
    }));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXZhbGFuY2hlLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi90ZXN0cy9hdmFsYW5jaGUudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFBLHNFQUF3QztBQUN4Qyw2QkFBZ0M7QUFDaEMsMENBQTBDO0FBQzFDLDRDQUE4QztBQUM5Qyw2Q0FBZ0Q7QUFDaEQsMkNBQTRDO0FBQzVDLCtDQUFvRDtBQUNwRCw4Q0FBa0Q7QUFDbEQsaURBQXlEO0FBQ3pELHVDQUFvQztBQUdwQyxRQUFRLENBQUMsV0FBVyxFQUFFLEdBQUcsRUFBRTtJQUN2QixNQUFNLFlBQVksR0FBVSxtREFBbUQsQ0FBQztJQUNoRixNQUFNLEVBQUUsR0FBRyxXQUFXLENBQUM7SUFDdkIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ2xCLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQztJQUN6QixJQUFJLFNBQW1CLENBQUM7SUFDeEIsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNYLFNBQVMsR0FBRyxJQUFJLGVBQVMsQ0FBQyxFQUFFLEVBQUMsSUFBSSxFQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMvRSxTQUFTLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxjQUFRLENBQUMsQ0FBQztRQUNwQyxTQUFTLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxZQUFNLEVBQUUsaUJBQWlCLEVBQUUsWUFBWSxDQUFDLENBQUE7UUFDbkUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsZUFBUyxDQUFDLENBQUM7UUFDdEMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsYUFBTyxDQUFDLENBQUM7UUFDbEMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsaUJBQVcsQ0FBQyxDQUFDO1FBQzFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLGdCQUFV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a0F4aW9zIGZyb20gJ2plc3QtbW9jay1heGlvcyc7XG5pbXBvcnQgeyBBdmFsYW5jaGUgfSBmcm9tIFwic3JjXCI7XG5pbXBvcnQgeyBBVk1BUEkgfSBmcm9tIFwic3JjL2FwaXMvYXZtL2FwaVwiO1xuaW1wb3J0IHsgQWRtaW5BUEkgfSBmcm9tIFwic3JjL2FwaXMvYWRtaW4vYXBpXCI7XG5pbXBvcnQgeyBIZWFsdGhBUEkgfSBmcm9tICdzcmMvYXBpcy9oZWFsdGgvYXBpJztcbmltcG9ydCB7IEluZm9BUEkgfSBmcm9tIFwic3JjL2FwaXMvaW5mby9hcGlcIjtcbmltcG9ydCB7IEtleXN0b3JlQVBJIH0gZnJvbSBcInNyYy9hcGlzL2tleXN0b3JlL2FwaVwiO1xuaW1wb3J0IHsgTWV0cmljc0FQSSB9IGZyb20gXCJzcmMvYXBpcy9tZXRyaWNzL2FwaVwiO1xuaW1wb3J0IHsgUGxhdGZvcm1WTUFQSSB9ICBmcm9tIFwic3JjL2FwaXMvcGxhdGZvcm12bS9hcGlcIjtcbmltcG9ydCB7IFRlc3RBUEkgfSBmcm9tICcuL3Rlc3RsaWInO1xuaW1wb3J0IHsgQXhpb3NSZXF1ZXN0Q29uZmlnIH0gZnJvbSAnYXhpb3MnO1xuXG5kZXNjcmliZSgnQXZhbGFuY2hlJywgKCkgPT4ge1xuICAgIGNvbnN0IGJsb2NrY2hhaW5pZDpzdHJpbmcgPSBcIjZoMnM1ZGUxVkM2NW1lYWpFMUwyUGp2WjFNWHZIYzNGNmVxUENHS3VEdDRNeGl3ZUZcIjtcbiAgICBjb25zdCBpcCA9ICcxMjcuMC4wLjEnO1xuICAgIGNvbnN0IHBvcnQgPSA5NjUwO1xuICAgIGNvbnN0IHByb3RvY29sID0gXCJodHRwc1wiO1xuICAgIGxldCBhdmFsYW5jaGU6QXZhbGFuY2hlO1xuICAgIGJlZm9yZUFsbCgoKSA9PiB7XG4gICAgICAgIGF2YWxhbmNoZSA9IG5ldyBBdmFsYW5jaGUoaXAscG9ydCxwcm90b2NvbCwgMTIzNDUsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB0cnVlKTtcbiAgICAgICAgYXZhbGFuY2hlLmFkZEFQSShcImFkbWluXCIsIEFkbWluQVBJKTtcbiAgICAgICAgYXZhbGFuY2hlLmFkZEFQSShcInhjaGFpblwiLCBBVk1BUEksIFwiL2V4dC9zdWJuZXQvYXZtXCIsIGJsb2NrY2hhaW5pZClcbiAgICAgICAgYXZhbGFuY2hlLmFkZEFQSShcImhlYWx0aFwiLCBIZWFsdGhBUEkpO1xuICAgICAgICBhdmFsYW5jaGUuYWRkQVBJKFwiaW5mb1wiLCBJbmZvQVBJKTtcbiAgICAgICAgYXZhbGFuY2hlLmFkZEFQSShcImtleXN0b3JlXCIsIEtleXN0b3JlQVBJKTtcbiAgICAgICAgYXZhbGFuY2hlLmFkZEFQSShcIm1ldHJpY3NcIiwgTWV0cmljc0FQSSk7XG4gICAgICAgIGF2YWxhbmNoZS5hZGRBUEkoXCJwY2hhaW5cIiwgUGxhdGZvcm1WTUFQSSk7XG4gICAgfSk7XG4gICAgdGVzdCgnQ2FuIGluaXRpYWxpemUnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdChhdmFsYW5jaGUuZ2V0SVAoKSkudG9CZShpcCk7XG4gICAgICAgIGV4cGVjdChhdmFsYW5jaGUuZ2V0UG9ydCgpKS50b0JlKHBvcnQpO1xuICAgICAgICBleHBlY3QoYXZhbGFuY2hlLmdldFByb3RvY29sKCkpLnRvQmUocHJvdG9jb2wpO1xuICAgICAgICBleHBlY3QoYXZhbGFuY2hlLmdldFVSTCgpKS50b0JlKGAke3Byb3RvY29sfTovLyR7aXB9OiR7cG9ydH1gKTtcbiAgICAgICAgZXhwZWN0KGF2YWxhbmNoZS5nZXROZXR3b3JrSUQoKSkudG9CZSgxMjM0NSk7XG4gICAgICAgIGF2YWxhbmNoZS5zZXROZXR3b3JrSUQoNTApO1xuICAgICAgICBleHBlY3QoYXZhbGFuY2hlLmdldE5ldHdvcmtJRCgpKS50b0JlKDUwKTtcbiAgICAgICAgYXZhbGFuY2hlLnNldE5ldHdvcmtJRCgxMjM0NSk7XG4gICAgICAgIGV4cGVjdChhdmFsYW5jaGUuZ2V0TmV0d29ya0lEKCkpLnRvQmUoMTIzNDUpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnRW5kcG9pbnRzIGNvcnJlY3QnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdChhdmFsYW5jaGUuQWRtaW4oKSkubm90LnRvQmVJbnN0YW5jZU9mKEFWTUFQSSk7XG4gICAgICAgIGV4cGVjdChhdmFsYW5jaGUuQWRtaW4oKSkudG9CZUluc3RhbmNlT2YoQWRtaW5BUEkpO1xuICAgICAgICBcbiAgICAgICAgZXhwZWN0KGF2YWxhbmNoZS5YQ2hhaW4oKSkubm90LnRvQmVJbnN0YW5jZU9mKEFkbWluQVBJKTtcbiAgICAgICAgZXhwZWN0KGF2YWxhbmNoZS5YQ2hhaW4oKSkudG9CZUluc3RhbmNlT2YoQVZNQVBJKTtcblxuICAgICAgICBleHBlY3QoYXZhbGFuY2hlLkhlYWx0aCgpKS5ub3QudG9CZUluc3RhbmNlT2YoS2V5c3RvcmVBUEkpO1xuICAgICAgICBleHBlY3QoYXZhbGFuY2hlLkhlYWx0aCgpKS50b0JlSW5zdGFuY2VPZihIZWFsdGhBUEkpO1xuXG4gICAgICAgIGV4cGVjdChhdmFsYW5jaGUuSW5mbygpKS5ub3QudG9CZUluc3RhbmNlT2YoS2V5c3RvcmVBUEkpO1xuICAgICAgICBleHBlY3QoYXZhbGFuY2hlLkluZm8oKSkudG9CZUluc3RhbmNlT2YoSW5mb0FQSSk7XG4gICAgICAgIFxuICAgICAgICBleHBlY3QoYXZhbGFuY2hlLlBDaGFpbigpKS5ub3QudG9CZUluc3RhbmNlT2YoS2V5c3RvcmVBUEkpO1xuICAgICAgICBleHBlY3QoYXZhbGFuY2hlLlBDaGFpbigpKS50b0JlSW5zdGFuY2VPZihQbGF0Zm9ybVZNQVBJKTtcblxuICAgICAgICBleHBlY3QoYXZhbGFuY2hlLk5vZGVLZXlzKCkpLm5vdC50b0JlSW5zdGFuY2VPZihQbGF0Zm9ybVZNQVBJKTtcbiAgICAgICAgZXhwZWN0KGF2YWxhbmNoZS5Ob2RlS2V5cygpKS50b0JlSW5zdGFuY2VPZihLZXlzdG9yZUFQSSk7XG5cbiAgICAgICAgZXhwZWN0KGF2YWxhbmNoZS5NZXRyaWNzKCkpLm5vdC50b0JlSW5zdGFuY2VPZihLZXlzdG9yZUFQSSk7XG4gICAgICAgIGV4cGVjdChhdmFsYW5jaGUuTWV0cmljcygpKS50b0JlSW5zdGFuY2VPZihNZXRyaWNzQVBJKTtcblxuICAgICAgICBleHBlY3QoYXZhbGFuY2hlLkFkbWluKCkuZ2V0UlBDSUQoKSkudG9CZSgxKTtcbiAgICAgICAgZXhwZWN0KGF2YWxhbmNoZS5YQ2hhaW4oKS5nZXRSUENJRCgpKS50b0JlKDEpO1xuICAgICAgICBleHBlY3QoYXZhbGFuY2hlLlBDaGFpbigpLmdldFJQQ0lEKCkpLnRvQmUoMSk7XG4gICAgICAgIGV4cGVjdChhdmFsYW5jaGUuTm9kZUtleXMoKS5nZXRSUENJRCgpKS50b0JlKDEpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnQ3JlYXRlIG5ldyBBUEknLCAoKSA9PiB7XG4gICAgICAgIGF2YWxhbmNoZS5hZGRBUEkoXCJhdm0yXCIsIEFWTUFQSSk7XG4gICAgICAgIGV4cGVjdChhdmFsYW5jaGUuYXBpKFwiYXZtMlwiKSkudG9CZUluc3RhbmNlT2YoQVZNQVBJKTtcblxuICAgICAgICBhdmFsYW5jaGUuYWRkQVBJKFwia2V5c3RvcmUyXCIsIEtleXN0b3JlQVBJLCBcIi9leHQva2V5c3RvcmUyXCIpO1xuICAgICAgICBleHBlY3QoYXZhbGFuY2hlLmFwaShcImtleXN0b3JlMlwiKSkudG9CZUluc3RhbmNlT2YoS2V5c3RvcmVBUEkpO1xuXG4gICAgICAgIGF2YWxhbmNoZS5hcGkoXCJrZXlzdG9yZTJcIikuc2V0QmFzZVVSTChcIi9leHQva2V5c3RvcmUzXCIpO1xuICAgICAgICBleHBlY3QoYXZhbGFuY2hlLmFwaShcImtleXN0b3JlMlwiKS5nZXRCYXNlVVJMKCkpLnRvQmUoXCIvZXh0L2tleXN0b3JlM1wiKTtcblxuICAgICAgICBleHBlY3QoYXZhbGFuY2hlLmFwaShcImtleXN0b3JlMlwiKS5nZXREQigpKS50b0hhdmVQcm9wZXJ0eShcIm5hbWVzcGFjZVwiKTtcbiAgICB9KTtcblxufSk7XG5cbmRlc2NyaWJlKCdIVFRQIE9wZXJhdGlvbnMnLCAoKSA9PiB7XG4gIGNvbnN0IGlwID0gJzEyNy4wLjAuMSc7XG4gIGNvbnN0IHBvcnQgPSA4MDgwO1xuICBjb25zdCBwcm90b2NvbCA9ICdodHRwJztcbiAgY29uc3QgcGF0aCA9ICcvZXh0L3Rlc3RpbmdyZXF1ZXN0cyc7XG4gIGxldCBhdmFsYW5jaGU6QXZhbGFuY2hlO1xuICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgIGF2YWxhbmNoZSA9IG5ldyBBdmFsYW5jaGUoaXAsIHBvcnQsIHByb3RvY29sLCAxMjM0NSwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHRydWUpO1xuICAgIGF2YWxhbmNoZS5hZGRBUEkoJ3Rlc3RpbmdyZXF1ZXN0cycsIFRlc3RBUEksIHBhdGgpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIG1vY2tBeGlvcy5yZXNldCgpO1xuICB9KTtcblxuICB0ZXN0KCdHRVQgd29ya3MnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgaW5wdXQ6c3RyaW5nID0gJ1Rlc3RHRVQnO1xuICAgIGNvbnN0IGFwaTpUZXN0QVBJID0gYXZhbGFuY2hlLmFwaSgndGVzdGluZ3JlcXVlc3RzJyk7XG4gICAgY29uc3QgcmVzdWx0OlByb21pc2U8b2JqZWN0PiA9IGFwaS5UZXN0R0VUKGlucHV0LCBgLyR7aW5wdXR9YCk7XG4gICAgY29uc3QgcGF5bG9hZDpvYmplY3QgPSB7XG4gICAgICByZXN1bHQ6IHtcbiAgICAgICAgb3V0cHV0OiBpbnB1dCxcbiAgICAgIH0sXG4gICAgfTtcbiAgICBjb25zdCByZXNwb25zZU9iaiA9IHtcbiAgICAgIGRhdGE6IHBheWxvYWQsXG4gICAgfTtcbiAgICBtb2NrQXhpb3MubW9ja1Jlc3BvbnNlKHJlc3BvbnNlT2JqKTtcbiAgICBjb25zdCByZXNwb25zZTphbnkgPSBhd2FpdCByZXN1bHQ7XG4gICAgZXhwZWN0KG1vY2tBeGlvcy5yZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgZXhwZWN0KHJlc3BvbnNlLm91dHB1dCkudG9CZShpbnB1dCk7XG4gIH0pO1xuXG4gIHRlc3QoJ0RFTEVURSB3b3JrcycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBpbnB1dDpzdHJpbmcgPSAnVGVzdERFTEVURSc7XG4gICAgY29uc3QgYXBpOlRlc3RBUEkgPSBhdmFsYW5jaGUuYXBpKCd0ZXN0aW5ncmVxdWVzdHMnKTtcbiAgICBjb25zdCBheGlvc0NvbmZpZzpBeGlvc1JlcXVlc3RDb25maWcgPSB7XG4gICAgICBiYXNlVVJMOiBgJHtwcm90b2NvbH06Ly8ke2lwfToke3BvcnR9YCxcbiAgICAgIHJlc3BvbnNlVHlwZTogJ3RleHQnLFxuICAgIH07XG4gICAgY29uc3QgcmVzdWx0OlByb21pc2U8b2JqZWN0PiA9IGFwaS5UZXN0REVMRVRFKGlucHV0LCBgLyR7aW5wdXR9YCwgYXhpb3NDb25maWcpO1xuICAgIGNvbnN0IHBheWxvYWQ6b2JqZWN0ID0ge1xuICAgICAgcmVzdWx0OiB7XG4gICAgICAgIG91dHB1dDogaW5wdXQsXG4gICAgICB9LFxuICAgIH07XG4gICAgY29uc3QgcmVzcG9uc2VPYmogPSB7XG4gICAgICBkYXRhOiBwYXlsb2FkLFxuICAgIH07XG4gICAgbW9ja0F4aW9zLm1vY2tSZXNwb25zZShyZXNwb25zZU9iaik7XG4gICAgY29uc3QgcmVzcG9uc2U6YW55ID0gYXdhaXQgcmVzdWx0O1xuICAgIGV4cGVjdChtb2NrQXhpb3MucmVxdWVzdCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgIGV4cGVjdChyZXNwb25zZS5vdXRwdXQpLnRvQmUoaW5wdXQpO1xuICB9KTtcblxuICB0ZXN0KCdQT1NUIHdvcmtzJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGlucHV0OnN0cmluZyA9ICdUZXN0UE9TVCc7XG4gICAgY29uc3QgYXBpOlRlc3RBUEkgPSBhdmFsYW5jaGUuYXBpKCd0ZXN0aW5ncmVxdWVzdHMnKTtcbiAgICBjb25zdCByZXN1bHQ6UHJvbWlzZTxvYmplY3Q+ID0gYXBpLlRlc3RQT1NUKGlucHV0LCBgLyR7aW5wdXR9YCk7XG4gICAgY29uc3QgcGF5bG9hZDpvYmplY3QgPSB7XG4gICAgICByZXN1bHQ6IHtcbiAgICAgICAgb3V0cHV0OiBpbnB1dCxcbiAgICAgIH0sXG4gICAgfTtcbiAgICBjb25zdCByZXNwb25zZU9iaiA9IHtcbiAgICAgIGRhdGE6IHBheWxvYWQsXG4gICAgfTtcbiAgICBtb2NrQXhpb3MubW9ja1Jlc3BvbnNlKHJlc3BvbnNlT2JqKTtcbiAgICBjb25zdCByZXNwb25zZTphbnkgPSBhd2FpdCByZXN1bHQ7XG4gICAgZXhwZWN0KG1vY2tBeGlvcy5yZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgZXhwZWN0KHJlc3BvbnNlLm91dHB1dCkudG9CZShpbnB1dCk7XG4gIH0pO1xuXG4gIHRlc3QoJ1BVVCB3b3JrcycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBpbnB1dDpzdHJpbmcgPSAnVGVzdFBVVCc7XG4gICAgY29uc3QgYXBpOlRlc3RBUEkgPSBhdmFsYW5jaGUuYXBpKCd0ZXN0aW5ncmVxdWVzdHMnKTtcbiAgICBjb25zdCByZXN1bHQ6UHJvbWlzZTxvYmplY3Q+ID0gYXBpLlRlc3RQVVQoaW5wdXQsIGAvJHtpbnB1dH1gKTtcbiAgICBjb25zdCBwYXlsb2FkOm9iamVjdCA9IHtcbiAgICAgIHJlc3VsdDoge1xuICAgICAgICBvdXRwdXQ6IGlucHV0LFxuICAgICAgfSxcbiAgICB9O1xuICAgIGNvbnN0IHJlc3BvbnNlT2JqID0ge1xuICAgICAgZGF0YTogcGF5bG9hZCxcbiAgICB9O1xuICAgIG1vY2tBeGlvcy5tb2NrUmVzcG9uc2UocmVzcG9uc2VPYmopO1xuICAgIGNvbnN0IHJlc3BvbnNlOmFueSA9IGF3YWl0IHJlc3VsdDtcbiAgICBleHBlY3QobW9ja0F4aW9zLnJlcXVlc3QpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICBleHBlY3QocmVzcG9uc2Uub3V0cHV0KS50b0JlKGlucHV0KTtcbiAgfSk7XG5cbiAgdGVzdCgnUEFUQ0ggd29ya3MnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgaW5wdXQ6c3RyaW5nID0gJ1Rlc3RQQVRDSCc7XG4gICAgY29uc3QgYXBpOlRlc3RBUEkgPSBhdmFsYW5jaGUuYXBpKCd0ZXN0aW5ncmVxdWVzdHMnKTtcbiAgICBjb25zdCByZXN1bHQ6UHJvbWlzZTxvYmplY3Q+ID0gYXBpLlRlc3RQQVRDSChpbnB1dCwgYC8ke2lucHV0fWApO1xuICAgIGNvbnN0IHBheWxvYWQ6b2JqZWN0ID0ge1xuICAgICAgcmVzdWx0OiB7XG4gICAgICAgIG91dHB1dDogaW5wdXQsXG4gICAgICB9LFxuICAgIH07XG4gICAgY29uc3QgcmVzcG9uc2VPYmogPSB7XG4gICAgICBkYXRhOiBwYXlsb2FkLFxuICAgIH07XG4gICAgbW9ja0F4aW9zLm1vY2tSZXNwb25zZShyZXNwb25zZU9iaik7XG4gICAgY29uc3QgcmVzcG9uc2U6YW55ID0gYXdhaXQgcmVzdWx0O1xuICAgIGV4cGVjdChtb2NrQXhpb3MucmVxdWVzdCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgIGV4cGVjdChyZXNwb25zZS5vdXRwdXQpLnRvQmUoaW5wdXQpO1xuICB9KTtcbn0pO1xuIl19